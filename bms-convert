#! /bin/sh


for f in "$@"; do
    case "$f" in
    	*.md)
	    LINK='s/%\[\[([^ ]+) (.*)\]\]%/[\2](\1)/g'
	    ;;
	*)
	    LINK='s/%\[\[([^ ]+) (.*)\]\]%/<a href="\1">\2<\/a>/g'
	    ;;
    esac

    sed -E -i~ -e "$LINK" \
	-e '{:convert;s/^([a-zA-Z0-9_]+)-([a-zA-Z0-9_-]+):/\1\2:/;t convert}' \
	-e 's/^([a-zA-Z0-9_]+): (.*)$/\1: "\2"/' \
	-e 's/%\?\(([^)]+)\)\(/{% if \1 %}/g' -e 's/\)\(\)%/{% endif %}/g' \
	-e 's/\)\(([^)]+)\)%/{% else %}\1{% endif %}/g' \
	-e '{:convert;s/%([a-zA-Z0-9_]+)-([a-zA-Z0-9_-]+)(:[^%]*)?%/%\1\2\3%/;t convert}' \
	-e 's/%([a-zA-Z0-9_]+):([^%]*)%/{{ \1 | default: "\2" }}/g' \
	-e 's/%([a-zA-Z0-9_]+)%/{{ \1 }}/g' "$f"
done

